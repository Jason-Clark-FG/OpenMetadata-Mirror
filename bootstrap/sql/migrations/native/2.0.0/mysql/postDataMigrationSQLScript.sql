-- Migrate existing glossary term RELATED_TO relationships to include relationType
-- For backward compatibility, existing relations without a relationType are set to "related"

UPDATE entity_relationship
SET json = JSON_SET(COALESCE(json, '{}'), '$.relationType', 'related')
WHERE fromEntity = 'glossaryTerm'
  AND toEntity = 'glossaryTerm'
  AND relation = 15
  AND (json IS NULL OR JSON_EXTRACT(json, '$.relationType') IS NULL);

-- Insert default glossary term relation settings if they don't exist
-- This preserves any existing user customizations
INSERT INTO openmetadata_settings (configType, json)
SELECT 'glossaryTermRelationSettings', '{"relationTypes":[{"name":"relatedTo","displayName":"Related To","description":"General association between terms that are conceptually connected.","rdfPredicate":"skos:related","isSymmetric":true,"isTransitive":false,"isCrossGlossaryAllowed":true,"category":"associative","isSystemDefined":true,"color":"#1890ff"},{"name":"synonym","displayName":"Synonym","description":"Terms that have the same meaning and can be used interchangeably.","rdfPredicate":"skos:exactMatch","isSymmetric":true,"isTransitive":false,"isCrossGlossaryAllowed":true,"category":"equivalence","isSystemDefined":true,"color":"#722ed1"},{"name":"typeOf","displayName":"Type Of","description":"Classification where the subject is a specific type of the object.","inverseRelation":"hasTypes","rdfPredicate":"rdfs:subClassOf","isSymmetric":false,"isTransitive":true,"isCrossGlossaryAllowed":true,"category":"hierarchical","isSystemDefined":true,"color":"#52c41a"},{"name":"hasTypes","displayName":"Has Types","description":"Inverse of Type Of. The subject has specific types.","inverseRelation":"typeOf","rdfPredicate":"om:hasTypes","isSymmetric":false,"isTransitive":true,"isCrossGlossaryAllowed":true,"category":"hierarchical","isSystemDefined":true,"color":"#73d13d"},{"name":"componentOf","displayName":"Component Of","description":"The subject is a component or part of the object.","inverseRelation":"composedOf","rdfPredicate":"om:componentOf","isSymmetric":false,"isTransitive":false,"isCrossGlossaryAllowed":true,"category":"hierarchical","isSystemDefined":true,"color":"#13c2c2"},{"name":"composedOf","displayName":"Composed Of","description":"The subject is composed of or includes the object.","inverseRelation":"componentOf","rdfPredicate":"om:composedOf","isSymmetric":false,"isTransitive":false,"isCrossGlossaryAllowed":true,"category":"hierarchical","isSystemDefined":true,"color":"#36cfc9"},{"name":"calculatedFrom","displayName":"Calculated From","description":"The subject metric is calculated or derived from the object.","inverseRelation":"usedToCalculate","rdfPredicate":"prov:wasDerivedFrom","isSymmetric":false,"isTransitive":false,"isCrossGlossaryAllowed":true,"category":"associative","isSystemDefined":true,"color":"#faad14"},{"name":"usedToCalculate","displayName":"Used To Calculate","description":"The subject is used to calculate the object metric.","inverseRelation":"calculatedFrom","rdfPredicate":"om:usedToCalculate","isSymmetric":false,"isTransitive":false,"isCrossGlossaryAllowed":true,"category":"associative","isSystemDefined":true,"color":"#ffc53d"},{"name":"seeAlso","displayName":"See Also","description":"Reference to a related term that provides additional context.","rdfPredicate":"rdfs:seeAlso","isSymmetric":true,"isTransitive":false,"isCrossGlossaryAllowed":true,"category":"associative","isSystemDefined":true,"color":"#eb2f96"},{"name":"broader","displayName":"Broader Than","description":"The subject has a broader meaning than the object.","inverseRelation":"narrower","rdfPredicate":"skos:broader","isSymmetric":false,"isTransitive":true,"isCrossGlossaryAllowed":true,"category":"hierarchical","isSystemDefined":true,"color":"#597ef7"},{"name":"narrower","displayName":"Narrower Than","description":"The subject has a narrower meaning than the object.","inverseRelation":"broader","rdfPredicate":"skos:narrower","isSymmetric":false,"isTransitive":true,"isCrossGlossaryAllowed":true,"category":"hierarchical","isSystemDefined":true,"color":"#85a5ff"}]}'
WHERE NOT EXISTS (
  SELECT 1 FROM openmetadata_settings WHERE configType = 'glossaryTermRelationSettings'
);
