{
  "$id": "https://open-metadata.org/schema/entity/services/connections/pipeline/openLineageConnection.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "OpenLineageConnection",
  "description": "OpenLineage Connection Config",
  "type": "object",
  "javaType": "org.openmetadata.schema.services.connections.pipeline.OpenLineageConnection",
  "definitions": {
    "OpenLineageType": {
      "description": "Service type.",
      "type": "string",
      "enum": [
        "OpenLineage"
      ],
      "default": "OpenLineage"
    },
    "kafkaBrokerConfig": {
      "title": "Kafka",
      "description": "Kafka broker configuration for OpenLineage events.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "brokersUrl": {
          "title": "Kafka Brokers List",
          "description": "Kafka bootstrap servers URL.",
          "type": "string"
        },
        "topicName": {
          "title": "Topic Name",
          "description": "Topic from where OpenLineage events will be pulled.",
          "type": "string"
        },
        "consumerGroupName": {
          "title": "Consumer Group",
          "description": "Kafka consumer group name.",
          "type": "string"
        },
        "consumerOffsets": {
          "title": "Initial Consumer Offsets",
          "description": "Initial Kafka consumer offset.",
          "default": "earliest",
          "type": "string",
          "enum": [
            "earliest",
            "latest"
          ],
          "javaEnums": [
            {
              "name": "earliest"
            },
            {
              "name": "latest"
            }
          ]
        },
        "poolTimeout": {
          "title": "Single Pool Call Timeout",
          "description": "Max allowed wait time.",
          "type": "number",
          "default": 1.0
        },
        "sessionTimeout": {
          "title": "Broker Inactive Session Timeout",
          "description": "Max allowed inactivity time.",
          "type": "integer",
          "default": 30
        },
        "securityProtocol": {
          "title": "Kafka Security Protocol",
          "description": "Kafka security protocol config.",
          "default": "PLAINTEXT",
          "type": "string",
          "enum": [
            "PLAINTEXT",
            "SASL_PLAINTEXT",
            "SSL",
            "SASL_SSL"
          ],
          "javaEnums": [
            {
              "name": "PLAINTEXT"
            },
            {
              "name": "SASL_PLAINTEXT"
            },
            {
              "name": "SSL"
            },
            {
              "name": "SASL_SSL"
            }
          ]
        },
        "sslConfig": {
          "title": "SSL",
          "description": "SSL Configuration details.",
          "$ref": "../../../../security/ssl/verifySSLConfig.json#/definitions/sslConfig"
        },
        "saslConfig": {
          "title": "SASL",
          "description": "SASL Configuration details.",
          "$ref": "../../../../security/sasl/saslClientConfig.json"
        }
      },
      "required": [
        "brokersUrl",
        "topicName"
      ]
    },
    "kinesisBrokerConfig": {
      "title": "Kinesis",
      "description": "AWS Kinesis Data Streams configuration for OpenLineage events.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "streamName": {
          "title": "Stream Name",
          "description": "Kinesis Data Stream name.",
          "type": "string"
        },
        "awsConfig": {
          "title": "AWS Credentials Configuration",
          "description": "AWS credentials configuration.",
          "$ref": "../../../../security/credentials/awsCredentials.json"
        },
        "consumerOffsets": {
          "title": "Initial Consumer Offsets",
          "description": "Initial Kinesis shard iterator type.",
          "default": "TRIM_HORIZON",
          "type": "string",
          "enum": [
            "TRIM_HORIZON",
            "LATEST"
          ],
          "javaEnums": [
            {
              "name": "TRIM_HORIZON"
            },
            {
              "name": "LATEST"
            }
          ]
        },
        "poolTimeout": {
          "title": "Poll Interval",
          "description": "Poll interval in seconds.",
          "type": "number",
          "default": 1.0
        },
        "sessionTimeout": {
          "title": "Session Timeout",
          "description": "Max inactivity timeout in seconds.",
          "type": "integer",
          "default": 30
        }
      },
      "required": [
        "streamName",
        "awsConfig"
      ]
    }
  },
  "properties": {
    "type": {
      "description": "Service Type",
      "$ref": "#/definitions/OpenLineageType",
      "default": "OpenLineage"
    },
    "brokerConfig": {
      "title": "Broker Configuration",
      "description": "Event broker configuration. Choose between Kafka and Kinesis.",
      "oneOf": [
        {
          "$ref": "#/definitions/kafkaBrokerConfig"
        },
        {
          "$ref": "#/definitions/kinesisBrokerConfig"
        }
      ]
    },
    "pipelineFilterPattern": {
      "description": "Regex exclude pipelines.",
      "$ref": "../../../../type/filterPattern.json#/definitions/filterPattern",
      "title": "Default Pipeline Filter Pattern"
    },
    "supportsMetadataExtraction": {
      "$ref": "../connectionBasicType.json#/definitions/supportsMetadataExtraction"
    }
  },
  "required": ["brokerConfig"],
  "additionalProperties": false
}